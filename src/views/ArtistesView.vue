<template>
  <main class="bg-violet-800">
    <div class="flex p-4 items-center">
      <img src="/Eclipse.svg" alt="Eclipse" />
      <h2
        class="
          xl:text-7xl
          text-xl
          font-Barlow
          text-white
          leading-none
          font-bold
        "
      >
        Artistes
      </h2>
    </div>
    <div class="flex flex-wrap overflow-hidden md:-mx-4 lg:-mx-4 xl:-mx-4 p-5">
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>

      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>

      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
      <div
        class="
          w-full
          overflow-hidden
          md:my-4 md:px-4 md:w-1/2
          lg:my-4 lg:px-4 lg:w-1/3
          xl:my-4 xl:px-4 xl:w-1/3
        "
      >
        <img src="/defaut.png" alt="" />
        <p class="text-center lg:text:4xl text-white text-xl pb-5">
          Nom de l'artiste
        </p>
      </div>
    </div>

    <div>
      <h5>Liste des pays - Simple liste</h5>
    </div>

    <hr />
    <tbody>
      <tr v-for="part in listeArtiste" :key="part.id">
        <td class="text-center">
          <img
            class="media-object imageSmall"
            :src="part.photo"
            :alt="part.prenom + ' ' + part.nom"
          />
        </td>
        <td>
          <b>{{ part.nom }}</b>
        </td>
        <td>{{ part.prenom }}</td>
        <td>{{ part.nationalite }}</td>
        <td>{{ dateFr(part.naissance) }}</td>
        <td>
          <span title="Supprimer le participant" class="mr-2">
            <RouterLink
              :to="{ name: 'DeleteParticipant', params: { id: part.id } }"
            >
              <i class="fa fa-times fa-lg text-light"></i>
            </RouterLink>
          </span>
          <span title="Modifier le participant" class="mr-2">
            <!-- Pour passer un paramètre dans la navigation :
                                On utilise le nom de la route
                                l'attribut params, permet de préciser le nom du paramètre (id) 
                                et sa valeur (part.id, id du participant) 
                                -->
            <RouterLink
              :to="{ name: 'UpdateParticipant', params: { id: part.id } }"
            >
              <i class="fa fa-edit fa-lg text-light"></i>
            </RouterLink>
          </span>
          <span title="Gérer les participations aux vidéos">
            <a href="#">
              <i class="fa fa-television fa-lg text-light"></i>
            </a>
          </span>
        </td>
      </tr>
    </tbody>
  </main>
</template>

<script>
// Bibliothèque Firestore : import des fonctions
import {
  getFirestore, // Obtenir le Firestore
  collection, // Utiliser une collection de documents
  doc, // Obtenir un document par son id
  getDocs, // Obtenir la liste des documents d'une collection
  addDoc, // Ajouter un document à une collection
  updateDoc, // Mettre à jour un document dans une collection
  deleteDoc, // Supprimer un document d'une collection
  onSnapshot, // Demander une liste de documents d'une collection, en les synchronisant
  query, // Permet d'effectuer des requêtes sur Firestore
  orderBy, // Permet de demander le tri d'une requête query
} from "https://www.gstatic.com/firebasejs/9.7.0/firebase-firestore.js";

// Cloud Storage : import des fonctions
import {
  getStorage, // Obtenir le Cloud Storage
  ref, // Pour créer une référence à un fichier à uploader
  getDownloadURL, // Permet de récupérer l'adress complète d'un fichier du Storage
  uploadString, // Permet d'uploader sur le Cloud Storage une image en Base64
} from "https://www.gstatic.com/firebasejs/9.7.0/firebase-storage.js";

export default {
  name: "ListeView",
  data() {
    return {
      listeArtiste: [], // Liste des participants
    };
  },
  mounted() {
    // Montage de la vue
    // Appel de la liste des participants
    this.getParticipants();
  },
  methods: {
    async getParticipants() {
      // Obtenir Firestore
      const firestore = getFirestore();
      // Base de données (collection)  document participant
      const dbPart = collection(firestore, "participant");
      // Liste des participants triés sur leur nom
      const q = query(dbPart, orderBy("nom", "asc"));
      await onSnapshot(q, (snapshot) => {
        this.listeArtiste = snapshot.docs.map((doc) => ({
          id: doc.id,
          ...doc.data(),
        }));
        // Récupération des images de chaque participant
        // parcours de la liste
        this.listeArtiste.forEach(function (personne) {
          // Obtenir le Cloud Storage
          const storage = getStorage();
          // Récupération de l'image par son nom de fichier
          const spaceRef = ref(storage, "participant/" + personne.photo);
          // Récupération de l'url complète de l'image
          getDownloadURL(spaceRef)
            .then((url) => {
              // On remplace le nom du fichier
              // Par l'url complète de la photo
              personne.photo = url;
            })
            .catch((error) => {
              console.log("erreur downloadUrl", error);
            });
        });
      });
    },

    // Format date en français
    dateFr(d) {
      let date = d.split("-");
      return date[2] + "/" + date[1] + "/" + date[0];
    },
  },
};
</script>